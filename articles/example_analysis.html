<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Example analysis • GWlasso</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Example analysis">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">GWlasso</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example_analysis.html">Example analysis</a></li>
  </ul>
</li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/nibortolum/GWlasso/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Example analysis</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/nibortolum/GWlasso/blob/main/vignettes/example_analysis.Rmd" class="external-link"><code>vignettes/example_analysis.Rmd</code></a></small>
      <div class="d-none name"><code>example_analysis.Rmd</code></div>
    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/nibortolum/GWlasso" class="external-link">GWlasso</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="what-is-a-geographically-weighted-model">What is a Geographically Weighted Model ?<a class="anchor" aria-label="anchor" href="#what-is-a-geographically-weighted-model"></a>
</h2>
<p>Imagine you want to predict an environmental variable
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
on one site based on the distribution of species of some kind you
observed in this site. You will fit a model on data, gathered around the
world, associating species distribution and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>.</p>
<p>Now, the problem is that species are not ubiquitous, and the
distribution of species, although varying according to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>,
also varies according to latitude and longitude. This means that a
species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>A</mi><annotation encoding="application/x-tex">A</annotation></semantics></math>
may be strongly linked to
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>Y</mi><annotation encoding="application/x-tex">Y</annotation></semantics></math>
in England but not at all in Bulgaria for instance. Or a species
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>B</mi><annotation encoding="application/x-tex">B</annotation></semantics></math>
could be completely absent in some areas. Geographically weighted models
tackle these issues by taking into account the spatial heterogeneity of
species distribution.</p>
<p>It relies on two parameters :</p>
<ul>
<li>the bandwidth</li>
<li>the distance between sampling sites</li>
</ul>
<p>The <strong>bandwidth</strong> determine the number of samples around
our sample of interest used to fit the model. It can be of two kind
:</p>
<ul>
<li>fixed : the bandwidth is then the <em>radius</em> around the sample
of interest into which the samples must be to used to fit the
model.</li>
<li>adaptive : the bandwidth is then the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
closest sample around the sample of interest that will be used to fit
the model</li>
</ul>
</div>
<div class="section level2">
<h2 id="what-is-lasso">What is Lasso ?<a class="anchor" aria-label="anchor" href="#what-is-lasso"></a>
</h2>
<p>Without giving much details, let’s say that lasso is a regression
method that seeks to have the best accuracy while discarding variables
that are not really informative for the prediction (the linera
coefficient for these variables will be shrunk to zero).</p>
<p>It is especially useful in ecology to tackle the non ubiquitous
nature of species. With each local regression, the species can have
different informative values depending on the area they’re found. Lasso
will take care of that.</p>
</div>
<div class="section level2">
<h2 id="what-to-run">What to run<a class="anchor" aria-label="anchor" href="#what-to-run"></a>
</h2>
<div class="section level3">
<h3 id="data">data<a class="anchor" aria-label="anchor" href="#data"></a>
</h3>
<p>In our example, we will use dataset from Amesbury (2016). Load it up
with.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">Amesbury</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="setting-the-bandwith">Setting the bandwith<a class="anchor" aria-label="anchor" href="#setting-the-bandwith"></a>
</h3>
<p>One key element to fit geographically weighted models is the
bandwidth. There is no rule of thumb, as it depends on the distribution
of the samples used to fit the model on one hand, and the
biogeographical properties of the investigated species. Nevertheless, if
the samples used to fit the model are somewhat geographically evenly
distributed, a fixed bandwidth will do the job.</p>
<p>To select the bandwidth you need :</p>
<ul>
<li>a distance matrix</li>
<li>a species abundance matrix (or data frame). It should be transformed
in a suitable format for regressions, such as relative abundance or
hellinger transformation. See [vegan::decostand()]</li>
<li>a vector containing the environmental variable to predict.</li>
</ul>
<p>The function <em>gwl_bw_estimation</em> run a bruteforce algorithm to
select the bandwidth that produces the smallest
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mrow><mi>R</mi><mi>M</mi><mi>S</mi><mi>E</mi></mrow><annotation encoding="application/x-tex">RMSE</annotation></semantics></math>.</p>
<p>In the following example :</p>
<ul>
<li>
<em>coords.sample</em> is a dataframe with two columnes containing
latitude and longitude of the samples</li>
<li>
<em>sp.df</em> is a dataframe contaning species as columns and
samples as rows</li>
<li>
<em>my.y</em> is the environmental variable of interest, to
reconstruct</li>
<li>for the other arguments please refer to the help page of the
functions</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># compute the distance matrix</span></span>
<span><span class="va">distance_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_distance_matrix.html">compute_distance_matrix</a></span><span class="op">(</span><span class="va">Amesbury</span><span class="op">$</span><span class="va">coords</span>, add.noise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># run the bw selection algorithm</span></span>
<span><span class="va">bw_choice</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gwl_bw_estimation.html">gwl_bw_estimation</a></span><span class="op">(</span>x.var <span class="op">=</span> <span class="va">Amesbury</span><span class="op">$</span><span class="va">spe.df</span>,</span>
<span>                      y.var <span class="op">=</span> <span class="va">Amesbury</span><span class="op">$</span><span class="va">WTD</span>,</span>
<span>                      dist.mat <span class="op">=</span> <span class="va">distance_matrix</span>,</span>
<span>                      adaptive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      adptbwd.thresh <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>                      kernel <span class="op">=</span> <span class="st">"bisquare"</span>,</span>
<span>                      alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      progress <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      n <span class="op">=</span> <span class="fl">100</span><span class="op">)</span></span></code></pre></div>
<p>This command is <strong>extremely long to run</strong>. For a dataset
of 1100 samples and 45 species it takes approximately 24 hours.The time
can be reduced by playing with the
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mi>n</mi><annotation encoding="application/x-tex">n</annotation></semantics></math>
parameter, that set the number of bandwidths to test. Parallelizing the
code is a work in progress.</p>
</div>
<div class="section level3">
<h3 id="fitting-a-model">Fitting a model<a class="anchor" aria-label="anchor" href="#fitting-a-model"></a>
</h3>
<p>Once you have chosen a bandwidth, you can pursue. If you do not wich
to run <em>gwl_bw_estimation()</em>, you can eyeball a bandwith, relying
on your ecological expertise.</p>
<p>Let’s say that you decide to go for an adaptive bandwidth of 120. It
means that for each sample, a model will be computed with the 120
closest sample.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># compute the distance matrix</span></span>
<span><span class="va">distance_matrix</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/compute_distance_matrix.html">compute_distance_matrix</a></span><span class="op">(</span><span class="va">Amesbury</span><span class="op">$</span><span class="va">coords</span>, add.noise <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">my.gwl.fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/gwl_fit.html">gwl_fit</a></span><span class="op">(</span>bw<span class="op">=</span> <span class="fl">120</span>,</span>
<span>                     x.var <span class="op">=</span> <span class="va">Amesbury</span><span class="op">$</span><span class="va">spe.df</span>,</span>
<span>                      y.var <span class="op">=</span> <span class="va">Amesbury</span><span class="op">$</span><span class="va">WTD</span>,</span>
<span>                      dist.mat <span class="op">=</span> <span class="va">distance_matrix</span>,</span>
<span>                      adaptive <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                      kernel <span class="op">=</span> <span class="st">"bisquare"</span>,</span>
<span>                      alpha <span class="op">=</span> <span class="fl">1</span>,</span>
<span>                      progress <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">my.gwl.fit</span><span class="op">)</span></span></code></pre></div>
<p>The graph rendered by this chunk displayed shows you whether
coefficient was set to zero or not for each species, fo each model
(remember that in a GWL there is one local modal per sample). The upper
panel show you the mean of the y.var values of the samples used to fit
the local model. In ecology, it may help to grasp a sense of the
indicative value of a taxa for a given ecological variable.</p>
</div>
<div class="section level3">
<h3 id="make-prediction">Make prediction<a class="anchor" aria-label="anchor" href="#make-prediction"></a>
</h3>
<p>Once you fitted your model, you can of course use it as any other
model in R to make prediction :</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">my_predicted_values</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html" class="external-link">predict</a></span><span class="op">(</span><span class="va">my.gwl.fit</span>, newdata <span class="op">=</span> <span class="va">Amesbury</span><span class="op">$</span><span class="va">spe.df</span>, newcoords <span class="op">=</span> <span class="va">Amesbury</span><span class="op">$</span><span class="va">coords</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span> <span class="va">my_predicted_values</span> <span class="op">~</span><span class="va">Amesbury</span><span class="op">$</span><span class="va">WTD</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/abline.html" class="external-link">abline</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">1</span>, col<span class="op">=</span><span class="st">"red"</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Matthieu Mulot, Sophie Erb.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
